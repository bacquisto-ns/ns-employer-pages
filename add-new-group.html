<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="format-detection" content="telephone=no">
    <title>NueSynergy Agency Connection Form</title>
    <!-- GoHighLevel Embedding Optimization -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <!-- Performance: Preload critical resources from branding guide -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" as="style">
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" as="style">

    <!-- CSS Frameworks & Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <!-- Load Tailwind CSS with error handling -->
    <script>
        // Load Tailwind CSS with proper error handling
        (function() {
            const script = document.createElement('script');
            script.src = 'https://cdn.tailwindcss.com';
            script.crossOrigin = 'anonymous';
            script.onerror = function() {
                console.warn('Tailwind CSS failed to load. Form will use fallback styles.');
                // Add fallback utility classes
                const fallbackStyle = document.createElement('style');
                fallbackStyle.textContent = `
                    .container { max-width: 1200px; margin: 0 auto; padding: 1rem; }
                    .mx-auto { margin-left: auto; margin-right: auto; }
                    .max-w-4xl { max-width: 56rem; }
                    .p-4 { padding: 1rem; }
                    .mb-8 { margin-bottom: 2rem; }
                    .mb-6 { margin-bottom: 1.5rem; }
                    .mb-4 { margin-bottom: 1rem; }
                    .mb-2 { margin-bottom: 0.5rem; }
                    .mb-1 { margin-bottom: 0.25rem; }
                    .mt-1 { margin-top: 0.25rem; }
                    .mt-2 { margin-top: 0.5rem; }
                    .text-center { text-align: center; }
                    .text-left { text-align: left; }
                    .text-right { text-align: right; }
                    .text-2xl { font-size: 1.5rem; line-height: 2rem; }
                    .text-xl { font-size: 1.25rem; line-height: 1.75rem; }
                    .text-lg { font-size: 1.125rem; line-height: 1.75rem; }
                    .text-sm { font-size: 0.875rem; line-height: 1.25rem; }
                    .text-xs { font-size: 0.75rem; line-height: 1rem; }
                    .font-bold { font-weight: 700; }
                    .font-medium { font-weight: 500; }
                    .font-sans { font-family: Inter, sans-serif; }
                    .antialiased { -webkit-font-smoothing: antialiased; }
                    .rounded-lg { border-radius: 0.5rem; }
                    .shadow-xl { box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); }
                    .text-white { color: white; }
                    .overflow-hidden { overflow: hidden; }
                    .relative { position: relative; }
                    .absolute { position: absolute; }
                    .flex { display: flex; }
                    .flex-col { flex-direction: column; }
                    .items-center { align-items: center; }
                    .justify-between { justify-content: space-between; }
                    .gap-4 { gap: 1rem; }
                    .grid { display: grid; }
                    .grid-cols-1 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
                    .hidden { display: none; }
                    .block { display: block; }
                    .w-full { width: 100%; }
                    .h-3 { height: 0.75rem; }
                    .bg-gray-200 { background-color: #e5e7eb; }
                    .rounded-full { border-radius: 9999px; }
                    .opacity-90 { opacity: 0.9; }
                    .opacity-85 { opacity: 0.85; }
                    .opacity-0 { opacity: 0; }
                    .mr-2 { margin-right: 0.5rem; }
                    .mr-3 { margin-right: 0.75rem; }
                    .ml-2 { margin-left: 0.5rem; }
                    .ml-12 { margin-left: 3rem; }
                    .tracking-wide { letter-spacing: 0.025em; }
                    @media (min-width: 640px) {
                        .sm\\:p-8 { padding: 2rem; }
                        .sm\\:flex-row { flex-direction: row; }
                        .sm\\:items-center { align-items: center; }
                        .sm\\:ml-12 { margin-left: 3rem; }
                        .sm\\:text-right { text-align: right; }
                    }
                    @media (min-width: 768px) {
                        .md\\:col-span-1 { grid-column: span 1 / span 1; }
                        .md\\:col-span-2 { grid-column: span 2 / span 2; }
                        .md\\:grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
                        .md\\:flex-row { flex-direction: row; }
                        .md\\:text-right { text-align: right; }
                        .md\\:text-base { font-size: 1rem; }
                    }
                `;
                document.head.appendChild(fallbackStyle);
            };
            script.onload = function() {
                // Configure Tailwind after it loads
                if (typeof tailwind !== 'undefined') {
                    tailwind.config = {
                        theme: {
                            extend: {
                                fontFamily: {
                                    sans: ['Inter', 'sans-serif'],
                                },
                                colors: {
                                    'brand-blue': 'var(--primary-blue)',
                                    'brand-blue-light': 'var(--primary-blue-light)',
                                    'brand-green': 'var(--accent-green)',
                                    'brand-green-hover': 'var(--accent-green-hover)',
                                    'brand-text': 'var(--text-primary)',
                                }
                            },
                        },
                    };
                }
            };
            document.head.appendChild(script);
        })();
    </script>

    <!-- Animation Libraries - Loaded with error handling for iframe context -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" defer crossorigin="anonymous" onerror="console.warn('Anime.js failed to load, animations will be disabled.')"></script>
    <style>
        /* NueSynergy Brand Color Palette */
        :root {
            --primary-blue: #1E4E6B;
            --primary-blue-light: #2a5f7a;
            --accent-green: #A4C639;
            --accent-green-hover: #8fb332;
            --text-primary: #2d3748;
            --text-secondary: #64748b;
            --bg-primary: #f0f4f8;
            --bg-secondary: #e8f2f6;
            --bg-card: #ffffff;
            --bg-section-start: #f8fafc;
            --bg-section-end: #f1f5f9;
            --border-default: #e2e8f0;
            --border-focus: #A4C639;
            --error: #e53e3e;
        }

        /* Form Input Styles - Aligned with other forms */
        .form-input-brand {
            width: 100%;
            max-width: 100%;
            padding: 14px 16px;
            border: 2px solid var(--border-default);
            border-radius: 8px;
            font-size: 16px; /* Prevents zoom on iOS */
            color: var(--text-primary);
            background: white;
            transition: all 0.3s ease;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            min-height: 48px; /* Touch-friendly minimum */
            box-sizing: border-box;
        }
        
        .form-input-brand:focus {
            outline: none;
            border-color: var(--border-focus);
            box-shadow: 0 0 0 3px rgba(164, 198, 57, 0.1);
            transform: translateY(-1px);
        }
        
        .form-input-brand.error {
            border-color: var(--error);
            box-shadow: 0 0 0 3px rgba(229, 62, 62, 0.1);
        }
        
        /* Submit Button - Aligned with branding guide */
        .btn-submit-brand {
            padding: 16px 40px;
            background: linear-gradient(135deg, var(--accent-green) 0%, var(--accent-green-hover) 100%);
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(164, 198, 57, 0.3);
        }
        
        .btn-submit-brand:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(164, 198, 57, 0.4);
        }
        
        .btn-submit-brand:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        /* Modal Styles - Optimized for iframe embedding */
        .modal-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999; /* High z-index for iframe embedding */
            transition: opacity 0.3s ease;
            padding: 1rem;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch; /* iOS Safari fallback */
            overscroll-behavior: contain; /* Modern browsers - not supported in Safari iOS < 16 */
        }
        
        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 28rem;
            width: 100%;
            margin: 1rem;
            transform: translateY(0);
            transition: all 0.3s ease;
        }
        
        /* Section Headers - Aligned with other forms */
        .section-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--primary-blue);
            border-bottom: 2px solid var(--border-default);
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
        }
        
        .section-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--accent-green) 0%, var(--accent-green-hover) 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.9rem;
        }
        
        /* Form Card Styling */
        .form-card {
            background: linear-gradient(135deg, var(--bg-section-start) 0%, var(--bg-section-end) 100%);
            border-radius: 16px;
            padding: 2rem;
            border-left: 4px solid var(--accent-green);
            box-shadow: 0 8px 32px rgba(30, 78, 107, 0.1);
            transition: all 0.3s ease;
        }
        
        .form-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(30, 78, 107, 0.15);
        }
        
        @media (max-width: 768px) {
            .form-card:hover {
                transform: none; /* Disable hover effect on mobile */
            }
        }
        
        /* Journey Tracker Styles */
        .process-visualization {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 8px 32px rgba(30, 78, 107, 0.1);
        }
        
        @media (max-width: 768px) {
            .process-visualization {
                border-radius: 12px;
            }
        }
        
        .journey-step {
            position: relative;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 1.5rem 1rem;
            transition: all 0.3s ease;
            cursor: default;
            overflow: hidden;
        }
        
        .journey-step::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, transparent, var(--accent-green), transparent);
            transform: translateX(-100%);
            transition: transform 0.6s ease;
        }
        
        .journey-step:hover::before {
            transform: translateX(100%);
        }
        
        .journey-step-inner {
            position: relative;
            text-align: center;
        }
        
        .journey-icon-wrapper {
            position: relative;
            width: 60px;
            height: 60px;
            margin: 0 auto 1rem;
            background: linear-gradient(135deg, #f0f4f0 0%, #e5e7eb 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .journey-icon {
            font-size: 1.5rem;
            color: #6b7280;
            transition: all 0.3s ease;
        }
        
        .journey-number {
            position: absolute;
            top: -8px;
            right: -8px;
            width: 28px;
            height: 28px;
            background: linear-gradient(135deg, #6b7280 0%, #9ca3af 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 700;
            border: 3px solid white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .journey-checkmark {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            width: 70px;
            height: 70px;
            background: var(--accent-green);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            z-index: 2;
        }
        
        .journey-checkmark i {
            color: white;
            font-size: 1.75rem;
            font-weight: bold;
        }
        
        .journey-title {
            font-size: 0.95rem;
            font-weight: 600;
            color: #6b7280;
            margin-bottom: 0.5rem;
            transition: all 0.3s ease;
        }
        
        .journey-description {
            font-size: 0.75rem;
            color: #9ca3af;
            line-height: 1.3;
            transition: all 0.3s ease;
        }
        
        .journey-step.active {
            background: linear-gradient(135deg, var(--accent-green) 0%, var(--accent-green-hover) 100%);
            border-color: var(--accent-green);
            box-shadow: 0 8px 24px rgba(164, 198, 57, 0.3);
            transform: translateY(-4px);
        }
        
        .journey-step.active .journey-icon-wrapper {
            background: rgba(255, 255, 255, 0.3);
            animation: pulse 2s ease-in-out infinite;
        }
        
        .journey-step.active .journey-icon {
            color: white;
            transform: scale(1.1);
        }
        
        .journey-step.active .journey-number {
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-blue-light) 100%);
            box-shadow: 0 4px 12px rgba(30, 78, 107, 0.4);
        }
        
        .journey-step.active .journey-title,
        .journey-step.active .journey-description {
            color: white;
        }
        
        .journey-step.completed {
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-blue-light) 100%);
            border-color: var(--primary-blue);
            box-shadow: 0 4px 16px rgba(30, 78, 107, 0.2);
        }
        
        .journey-step.completed .journey-icon-wrapper {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .journey-step.completed .journey-icon {
            color: rgba(255, 255, 255, 0.5);
        }
        
        .journey-step.completed .journey-checkmark {
            transform: translate(-50%, -50%) scale(1);
        }
        
        .journey-step.completed .journey-checkmark.hidden {
            display: flex !important;
        }
        
        .journey-step.completed .journey-number {
            background: linear-gradient(135deg, var(--accent-green) 0%, var(--accent-green-hover) 100%);
        }
        
        .journey-step.completed .journey-title,
        .journey-step.completed .journey-description {
            color: white;
        }
        
        .journey-step.pending {
            opacity: 0.7;
        }
        
        .journey-step.pending:hover {
            opacity: 0.85;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(200%); }
        }
        
        .animate-shimmer {
            animation: shimmer 2s infinite;
        }
        
        /* Step Navigation */
        .form-step {
            display: none;
        }
        
        .form-step.active {
            display: block;
        }
        
        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 2px solid var(--border-default);
        }
        
        .btn-nav {
            padding: 14px 32px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-height: 48px; /* Touch-friendly minimum */
            min-width: 120px;
            touch-action: manipulation; /* Prevents double-tap zoom */
        }
        
        .btn-nav.prev {
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-blue-light) 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(30, 78, 107, 0.3);
        }
        
        .btn-nav.prev:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(30, 78, 107, 0.4);
        }
        
        .btn-nav.prev:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-nav.next {
            background: linear-gradient(135deg, var(--accent-green) 0%, var(--accent-green-hover) 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(164, 198, 57, 0.3);
        }
        
        .btn-nav.next:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(164, 198, 57, 0.4);
        }
        
        .btn-nav.submit {
            background: linear-gradient(135deg, var(--accent-green) 0%, var(--accent-green-hover) 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(164, 198, 57, 0.3);
        }
        
        .btn-nav.submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(164, 198, 57, 0.4);
        }
        
        /* Accessibility */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation: none !important;
                transition: none !important;
            }
        }
        
        /* Tablet Optimizations (768px - 1024px) */
        @media (min-width: 768px) and (max-width: 1024px) {
            .container {
                max-width: 100%;
                padding: 1.5rem;
            }
            
            .process-visualization {
                padding: 1.5rem;
            }
            
            .journey-step {
                padding: 1.25rem 0.75rem;
            }
            
            .form-card {
                padding: 2rem 1.5rem;
            }
            
            .grid {
                gap: 1rem;
            }
        }
        
        /* Mobile Optimizations (up to 768px) */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
                max-width: 100%;
            }
            
            /* Compact header for mobile */
            header {
                padding: 1.25rem 1rem !important;
                margin-bottom: 1.5rem;
            }
            
            header h1 {
                font-size: 1.75rem !important;
                margin-bottom: 0.5rem;
            }
            
            header p {
                font-size: 0.875rem !important;
            }
            
            header .text-left {
                margin-top: 0.75rem;
            }
            
            header .text-left p {
                font-size: 0.8rem !important;
                margin-bottom: 0.25rem;
            }
            
            /* Compact journey tracker */
            .process-visualization {
                padding: 1.25rem 1rem;
                margin-bottom: 1.5rem;
            }
            
            .process-visualization h3 {
                font-size: 1.25rem !important;
            }
            
            .process-visualization h3 i {
                font-size: 1.5rem !important;
            }
            
            .process-visualization .mb-6 {
                margin-bottom: 1rem !important;
            }
            
            /* Progress bar */
            .process-visualization .mb-8 {
                margin-bottom: 1rem !important;
            }
            
            /* Journey steps - more compact */
            .journey-step {
                padding: 0.875rem 0.5rem;
            }
            
            .journey-icon-wrapper {
                width: 45px;
                height: 45px;
                margin-bottom: 0.5rem;
            }
            
            .journey-icon {
                font-size: 1.1rem;
            }
            
            .journey-number {
                width: 22px;
                height: 22px;
                font-size: 0.65rem;
                top: -6px;
                right: -6px;
            }
            
            .journey-title {
                font-size: 0.8rem;
                margin-bottom: 0.25rem;
            }
            
            .journey-description {
                font-size: 0.65rem;
                line-height: 1.2;
            }
            
            /* Form card optimizations */
            .form-card {
                padding: 1.5rem 1rem;
                border-radius: 12px;
                margin-bottom: 1rem;
            }
            
            .form-card h1 {
                font-size: 1.5rem !important;
                margin-bottom: 0.5rem;
            }
            
            .form-card p {
                font-size: 0.875rem !important;
                margin-bottom: 1.25rem;
            }
            
            /* Form inputs */
            .form-input-brand {
                padding: 14px 14px;
                font-size: 16px; /* Prevents iOS zoom */
                margin-bottom: 0.25rem;
            }
            
            /* Labels and helper text */
            label {
                font-size: 0.875rem !important;
                margin-bottom: 0.5rem !important;
            }
            
            label + .form-input-brand + p,
            label + select + p {
                font-size: 0.75rem !important;
                margin-top: 0.25rem;
                line-height: 1.3;
            }
            
            /* Grid spacing - ensure proper spacing on mobile */
            .grid {
                gap: 1.25rem;
            }
            
            /* Form field containers - prevent overlap with proper spacing */
            .form-step .grid > div {
                margin-bottom: 0.75rem;
                padding: 0;
                min-height: 0; /* Changed from 'auto' - not supported in Firefox 22+ */
                display: flex;
                flex-direction: column;
                gap: 0.5rem;
            }
            
            /* Ensure fields don't overlap */
            .form-step .grid > div > label,
            .form-step .grid > div > input,
            .form-step .grid > div > select,
            .form-step .grid > div > p {
                width: 100%;
                max-width: 100%;
                box-sizing: border-box;
                flex-shrink: 0;
            }
            
            /* Remove conflicting margins */
            .form-step .grid > div > label {
                margin-bottom: 0;
            }
            
            .form-step .grid > div > p {
                margin-top: 0;
                margin-bottom: 0;
            }
            
            /* Navigation buttons */
            .btn-nav {
                padding: 14px 24px;
                font-size: 0.95rem;
                width: 100%;
                margin-bottom: 0.75rem;
            }
            
            .nav-buttons {
                flex-direction: column;
                gap: 0.75rem;
                margin-top: 1.5rem;
                padding-top: 1.25rem;
            }
            
            .nav-buttons button:last-child {
                margin-bottom: 0;
            }
            
            /* Modal optimizations */
            .modal-content {
                margin: 1rem;
                padding: 1.5rem;
                max-width: calc(100% - 2rem);
            }
            
            /* Better touch targets */
            select.form-input-brand,
            input.form-input-brand {
                min-height: 48px;
            }
        }
        
        /* Small mobile devices (up to 480px) */
        @media (max-width: 480px) {
            .container {
                padding: 0.75rem;
            }
            
            header {
                padding: 1rem 0.75rem !important;
            }
            
            header h1 {
                font-size: 1.5rem !important;
            }
            
            .process-visualization {
                padding: 1rem 0.75rem;
            }
            
            .process-visualization h3 {
                font-size: 1.125rem !important;
            }
            
            .form-card {
                padding: 1.25rem 0.75rem;
            }
            
            .form-card h1 {
                font-size: 1.25rem !important;
            }
            
            .grid {
                gap: 1rem;
            }
            
            /* Extra spacing for form fields on small mobile */
            .form-step .grid > div {
                margin-bottom: 0.5rem;
            }
            
            .journey-step {
                padding: 0.75rem 0.5rem;
            }
            
            .journey-icon-wrapper {
                width: 40px;
                height: 40px;
            }
            
            .journey-icon {
                font-size: 1rem;
            }
            
            .journey-title {
                font-size: 0.75rem;
            }
            
            .journey-description {
                font-size: 0.6rem;
            }
        }
        
        /* Large desktop optimizations (1920px+) */
        @media (min-width: 1920px) {
            .container {
                max-width: 1400px;
            }
            
            .form-card {
                padding: 3rem 2.5rem;
            }
        }
        
        /* Prevent text size adjustment on iOS */
        @media screen and (max-width: 768px) {
            html {
                -webkit-text-size-adjust: 100%; /* Safari */
                -moz-text-size-adjust: 100%; /* Firefox */
                text-size-adjust: 100%; /* Chrome/Edge - not supported in Firefox/Safari */
            }
        }
        
        /* Improved field grouping and spacing */
        .form-step > .grid > div {
            display: flex;
            flex-direction: column;
            min-width: 0; /* Prevents grid overflow */
            width: 100%;
        }
        
        /* Better label spacing */
        label {
            margin-bottom: 0.5rem;
            display: block;
            width: 100%;
        }
        
        /* Helper text styling */
        .form-input-brand + p,
        select.form-input-brand + p {
            margin-top: 0.375rem;
            line-height: 1.4;
            width: 100%;
        }
        
        /* Ensure form inputs don't overflow */
        .form-input-brand,
        select.form-input-brand {
            width: 100%;
            box-sizing: border-box;
            max-width: 100%;
        }
        
        /* Grid container fixes */
        .form-step .grid {
            width: 100%;
            display: grid;
            grid-template-columns: 1fr;
        }
        
        @media (min-width: 768px) {
            .form-step .grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        /* Responsive journey tracker header */
        @media (max-width: 640px) {
            .process-visualization > div:first-child {
                flex-direction: column;
                align-items: flex-start !important;
            }
            
            .process-visualization > div:first-child > div:last-child {
                margin-top: 0.75rem;
                text-align: left !important;
            }
        }
        
        /* Journey tracker - horizontal on desktop/tablet, 2x2 on mobile */
        .journey-step-grid {
            display: grid;
        }
        
        @media (min-width: 768px) {
            .journey-step-grid {
                grid-template-columns: repeat(4, 1fr) !important;
                grid-template-rows: 1fr !important;
            }
        }
        
        @media (max-width: 767px) {
            .journey-step-grid {
                grid-template-columns: repeat(2, 1fr) !important;
                grid-template-rows: repeat(2, 1fr) !important;
            }
        }
        
        /* Additional field spacing fixes - ensures all fields have proper spacing */
        .form-step .grid > div {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            padding-bottom: 0.5rem;
            min-width: 0;
            width: 100%;
            box-sizing: border-box;
        }
        
        @media (min-width: 768px) {
            .form-step .grid > div {
                padding-bottom: 0.75rem;
                gap: 0.5rem;
            }
        }
        
        /* Ensure labels, inputs, and helper text don't overflow */
        .form-step .grid > div > label,
        .form-step .grid > div > input,
        .form-step .grid > div > select,
        .form-step .grid > div > p {
            width: 100%;
            max-width: 100%;
            box-sizing: border-box;
            flex-shrink: 0;
        }
        
        /* Remove default margins that might cause overlap */
        .form-step .grid > div > label {
            margin-bottom: 0;
        }
        
        .form-step .grid > div > p {
            margin-top: 0;
            margin-bottom: 0;
        }
        
        /* CSS Classes to replace inline styles - Phase 1 */
        
        /* Body and Container Classes */
        .body-gradient {
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .container-wrapper {
            position: relative;
            z-index: 1;
        }
        
        /* Header Classes */
        .header-gradient {
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-blue-light) 100%);
            padding: 2.5rem 2rem;
        }
        
        .header-accent {
            background: radial-gradient(circle, rgba(164, 198, 57, 0.1) 0%, transparent 70%);
            animation: pulse 4s ease-in-out infinite;
        }
        
        /* Journey Tracker Classes */
        .journey-title-text {
            color: var(--primary-blue);
        }
        
        .journey-subtitle-text {
            color: var(--text-secondary);
        }
        
        .progress-text-green {
            color: var(--accent-green);
        }
        
        .progress-bar-gradient {
            width: 25%;
            background: linear-gradient(90deg, var(--accent-green) 0%, var(--accent-green-hover) 100%);
        }
        
        /* Form Section Classes */
        .form-section-title {
            color: var(--primary-blue);
        }
        
        .form-section-description {
            color: var(--text-secondary);
        }
        
        /* Form Field Classes */
        .form-label-primary {
            color: var(--text-primary);
        }
        
        .form-helper-text {
            color: var(--text-secondary);
        }
        
        .form-input-readonly {
            background-color: #f3f4f6;
            cursor: not-allowed;
        }
        
        /* Modal Classes */
        .modal-success-icon {
            width: 80px;
            height: 80px;
        }
        
        .modal-success-check-icon {
            width: 80px;
            height: 80px;
            position: relative;
            border-radius: 50%;
            box-sizing: content-box;
            border: 4px solid var(--accent-green);
        }
        
        .modal-success-line-tip {
            height: 5px;
            background-color: var(--accent-green);
            display: block;
            border-radius: 2px;
            position: absolute;
            z-index: 10;
            top: 46px;
            left: 14px;
            width: 25px;
            transform: rotate(45deg);
        }
        
        .modal-success-line-long {
            height: 5px;
            background-color: var(--accent-green);
            display: block;
            border-radius: 2px;
            position: absolute;
            z-index: 10;
            top: 38px;
            right: 8px;
            width: 47px;
            transform: rotate(-45deg);
        }
        
        .modal-error-icon {
            width: 80px;
            height: 80px;
        }
        
        .modal-error-check-icon {
            width: 80px;
            height: 80px;
            position: relative;
            border-radius: 50%;
            box-sizing: content-box;
            border: 4px solid var(--error);
        }
        
        .modal-error-line {
            height: 5px;
            background-color: var(--error);
            display: block;
            border-radius: 2px;
            position: absolute;
            z-index: 10;
            top: 38px;
            left: 18px;
            width: 44px;
        }
        
        .modal-error-line-rotate-45 {
            transform: rotate(45deg);
        }
        
        .modal-error-line-rotate-neg-45 {
            transform: rotate(-45deg);
        }
        
        .modal-title-text {
            color: var(--primary-blue);
        }
        
        .modal-message-text {
            color: var(--text-secondary);
        }
        
        .modal-button-primary {
            padding: 12px 24px;
            font-size: 1rem;
        }
        
        .modal-button-secondary {
            padding: 12px 24px;
            font-size: 1rem;
            background: linear-gradient(135deg, var(--text-secondary) 0%, var(--text-primary) 100%);
        }
        
        /* Navigation Button Classes */
        .submit-button-hidden {
            display: none;
            align-items: center;
        }
        
        /* Section Header Classes */
        .section-header-margin {
            margin-top: 1.5rem;
        }
    </style>
</head>
<body class="font-sans antialiased body-gradient">
            <div class="container mx-auto max-w-4xl p-4 sm:p-6 md:p-8 container-wrapper">
        
        <!-- Header Section - Aligned with other forms -->
        <header class="mb-8 rounded-lg shadow-xl text-white overflow-hidden relative animate-in header-gradient">
            <div class="relative z-10">
                <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                    <div>
                        <h1 class="text-4xl font-bold mb-2">NueSynergy</h1>
                        <p class="text-lg opacity-90 tracking-wide">CUSTOMER FOCUSED & TECHNOLOGY DRIVEN</p>
                    </div>
                    <div class="text-left md:text-right">
                        <p class="font-medium text-sm md:text-base opacity-85">
                            <i class="fas fa-phone-alt mr-2"></i>1-800-413-4138
                        </p>
                        <p class="font-medium text-sm md:text-base opacity-85 mt-1">
                            <i class="fas fa-envelope mr-2"></i>employersupport@nuesynergy.com
                        </p>
                    </div>
                </div>
            </div>
            <!-- Animated background accent -->
            <div class="absolute inset-0 z-0 header-accent"></div>
            <style>
                @keyframes pulse {
                    0%, 100% { transform: scale(1); opacity: 0.3; }
                    50% { transform: scale(1.1); opacity: 0.6; }
                }
            </style>
        </header>

        <!-- Journey Tracker -->
        <nav role="navigation" aria-label="Form progress" class="mb-8">
            <div class="process-visualization animate-in" id="journey-tracker">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4">
                    <div>
                        <h3 class="text-2xl font-bold flex items-center journey-title-text">
                            <i class="fas fa-route mr-3 text-3xl"></i>Your Journey
                        </h3>
                        <p class="text-sm mt-1 ml-0 sm:ml-12 journey-subtitle-text">Track your progress through the form</p>
                    </div>
                    <div class="text-left sm:text-right">
                        <span class="text-3xl font-bold progress-text-green" id="progressText">Step 1</span>
                        <p class="text-sm journey-subtitle-text">of 4 steps</p>
                    </div>
                </div>
                
                <!-- Animated Progress Bar -->
                <div class="relative w-full bg-gray-200 rounded-full h-3 mb-8 overflow-hidden">
                    <div class="h-3 rounded-full transition-all duration-700 ease-out relative progress-bar-gradient" 
                         id="progressBar">
                        <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white to-transparent opacity-30 animate-shimmer"></div>
                    </div>
                </div>
                
                <!-- Interactive Step Cards -->
                <div class="grid journey-step-grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4">
                    <!-- Step 1: Business Details -->
                    <div class="journey-step active" id="journey-step-1" data-step="1">
                        <div class="journey-step-inner">
                            <div class="journey-icon-wrapper">
                                <i class="fas fa-briefcase journey-icon"></i>
                                <div class="journey-checkmark hidden">
                                    <i class="fas fa-check"></i>
                                </div>
                            </div>
                            <div class="journey-number">1</div>
                            <h4 class="journey-title">Business</h4>
                            <p class="journey-description">Company details</p>
                        </div>
                    </div>
                    
                    <!-- Step 2: Prospect Info -->
                    <div class="journey-step pending" id="journey-step-2" data-step="2">
                        <div class="journey-step-inner">
                            <div class="journey-icon-wrapper">
                                <i class="fas fa-user-tie journey-icon"></i>
                                <div class="journey-checkmark hidden">
                                    <i class="fas fa-check"></i>
                                </div>
                            </div>
                            <div class="journey-number">2</div>
                            <h4 class="journey-title">Prospect</h4>
                            <p class="journey-description">Contact info</p>
                        </div>
                    </div>
                    
                    <!-- Step 3: Authorized Representative -->
                    <div class="journey-step pending" id="journey-step-3" data-step="3">
                        <div class="journey-step-inner">
                            <div class="journey-icon-wrapper">
                                <i class="fas fa-user-check journey-icon"></i>
                                <div class="journey-checkmark hidden">
                                    <i class="fas fa-check"></i>
                                </div>
                            </div>
                            <div class="journey-number">3</div>
                            <h4 class="journey-title">Authorized</h4>
                            <p class="journey-description">Representative</p>
                        </div>
                    </div>
                    
                    <!-- Step 4: Business Information -->
                    <div class="journey-step pending" id="journey-step-4" data-step="4">
                        <div class="journey-step-inner">
                            <div class="journey-icon-wrapper">
                                <i class="fas fa-info-circle journey-icon"></i>
                                <div class="journey-checkmark hidden">
                                    <i class="fas fa-check"></i>
                                </div>
                            </div>
                            <div class="journey-number">4</div>
                            <h4 class="journey-title">Information</h4>
                            <p class="journey-description">Business data</p>
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Form Section -->
        <form id="connectionForm" class="form-card">
            
            <h1 class="text-2xl font-bold mb-2 form-section-title">Employer Group Details</h1>
            <p class="text-sm mb-6 form-section-description">Please provide the following details to create the group.</p>

            

            <!-- Step 1: Business Details -->
            <div id="step-1" class="form-step active">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">


                <div class="md:col-span-1">
                    <label for="businessName" class="block text-sm font-medium form-label-primary">Business Name*</label>
                    <input type="text" id="businessName" name="businessName" class="form-input-brand" placeholder="e.g., Apex Solutions" required>
                    <p class="text-xs form-helper-text">The name for the sub-account/location.</p>
                </div>

                <div class="md:col-span-1">
                    <label for="legalBusinessName" class="block text-sm font-medium form-label-primary">Legal Business Name</label>
                    <input type="text" id="legalBusinessName" name="legalBusinessName" class="form-input-brand" placeholder="e.g., Apex Solutions LLC">
                    <p class="text-xs form-helper-text">The legal business name.</p>
                </div>

                <div class="md:col-span-1">
                    <label for="businessEmail" class="block text-sm font-medium mb-1 form-label-primary">Business Email</label>
                    <input type="email" id="businessEmail" name="businessEmail" class="form-input-brand" placeholder="contact@apex.com">
                    <p class="text-xs mt-1 form-helper-text">The business email address.</p>
                </div>

                <div class="md:col-span-1">
                    <label for="businessPhone" class="block text-sm font-medium mb-1 form-label-primary">Business Phone</label>
                    <input type="tel" id="businessPhone" name="businessPhone" class="form-input-brand" placeholder="+13145557777">
                    <p class="text-xs mt-1 form-helper-text">Include country code. E.g. +13145557777</p>
                </div>

                <div class="md:col-span-2">
                    <label for="businessAddress" class="block text-sm font-medium mb-1 form-label-primary">Business Address</label>
                    <input type="text" id="businessAddress" name="businessAddress" class="form-input-brand" placeholder="123 Main St">
                    <p class="text-xs mt-1 form-helper-text">The address of the business.</p>
                </div>

                <div class="md:col-span-1">
                    <label for="businessCity" class="block text-sm font-medium mb-1 form-label-primary">Business City</label>
                    <input type="text" id="businessCity" name="businessCity" class="form-input-brand" placeholder="New York">
                </div>

                <div class="md:col-span-1">
                    <label for="businessState" class="block text-sm font-medium mb-1 form-label-primary">Business State</label>
                    <select id="businessState" name="businessState" class="form-input-brand bg-white">
                        <option value="">Select State</option>
                        <option value="AL">Alabama</option>
                        <option value="AK">Alaska</option>
                        <option value="AZ">Arizona</option>
                        <option value="AR">Arkansas</option>
                        <option value="CA">California</option>
                        <option value="CO">Colorado</option>
                        <option value="CT">Connecticut</option>
                        <option value="DE">Delaware</option>
                        <option value="FL">Florida</option>
                        <option value="GA">Georgia</option>
                        <option value="HI">Hawaii</option>
                        <option value="ID">Idaho</option>
                        <option value="IL">Illinois</option>
                        <option value="IN">Indiana</option>
                        <option value="IA">Iowa</option>
                        <option value="KS">Kansas</option>
                        <option value="KY">Kentucky</option>
                        <option value="LA">Louisiana</option>
                        <option value="ME">Maine</option>
                        <option value="MD">Maryland</option>
                        <option value="MA">Massachusetts</option>
                        <option value="MI">Michigan</option>
                        <option value="MN">Minnesota</option>
                        <option value="MS">Mississippi</option>
                        <option value="MO">Missouri</option>
                        <option value="MT">Montana</option>
                        <option value="NE">Nebraska</option>
                        <option value="NV">Nevada</option>
                        <option value="NH">New Hampshire</option>
                        <option value="NJ">New Jersey</option>
                        <option value="NM">New Mexico</option>
                        <option value="NY">New York</option>
                        <option value="NC">North Carolina</option>
                        <option value="ND">North Dakota</option>
                        <option value="OH">Ohio</option>
                        <option value="OK">Oklahoma</option>
                        <option value="OR">Oregon</option>
                        <option value="PA">Pennsylvania</option>
                        <option value="RI">Rhode Island</option>
                        <option value="SC">South Carolina</option>
                        <option value="SD">South Dakota</option>
                        <option value="TN">Tennessee</option>
                        <option value="TX">Texas</option>
                        <option value="UT">Utah</option>
                        <option value="VT">Vermont</option>
                        <option value="VA">Virginia</option>
                        <option value="WA">Washington</option>
                        <option value="WV">West Virginia</option>
                        <option value="WI">Wisconsin</option>
                        <option value="WY">Wyoming</option>
                        <option value="DC">District of Columbia</option>
                    </select>
                </div>

                <div class="md:col-span-1">
                    <label for="businessPostalCode" class="block text-sm font-medium mb-1 form-label-primary">Business Postal Code</label>
                    <input type="text" id="businessPostalCode" name="businessPostalCode" class="form-input-brand" placeholder="10001">
                </div>

                <div class="md:col-span-1">
                    <label for="country" class="block text-sm font-medium mb-1 form-label-primary">Country</label>
                    <input type="text" id="country" name="country" class="form-input-brand form-input-readonly" value="US" readonly>
                    <p class="text-xs mt-1 form-helper-text">Country is set to US.</p>
                </div>

                <div class="md:col-span-1">
                    <label for="businessWebsite" class="block text-sm font-medium mb-1 form-label-primary">Business Website</label>
                    <input type="url" id="businessWebsite" name="businessWebsite" class="form-input-brand" placeholder="https://www.apex.com">
                </div>

                <div class="md:col-span-1">
                    <label for="timeZone" class="block text-sm font-medium mb-1 form-label-primary">Time Zone</label>
                    <select id="timeZone" name="timeZone" class="form-input-brand bg-white">
                        <option value="">Select Time Zone</option>
                        <option value="America/New_York">Eastern Time (ET) - America/New_York</option>
                        <option value="America/Chicago">Central Time (CT) - America/Chicago</option>
                        <option value="America/Denver">Mountain Time (MT) - America/Denver</option>
                        <option value="America/Phoenix">Mountain Time - Arizona (MST) - America/Phoenix</option>
                        <option value="America/Los_Angeles">Pacific Time (PT) - America/Los_Angeles</option>
                        <option value="America/Anchorage">Alaska Time (AKT) - America/Anchorage</option>
                        <option value="Pacific/Honolulu">Hawaii-Aleutian Time (HAT) - Pacific/Honolulu</option>
                    </select>
                    <p class="text-xs mt-1 form-helper-text">Select your US time zone.</p>
                </div>

                <div class="md:col-span-2">
                    <label for="logoUrl" class="block text-sm font-medium mb-1 form-label-primary">Logo URL</label>
                    <input type="url" id="logoUrl" name="logoUrl" class="form-input-brand" placeholder="https://.../logo.png">
                    <p class="text-xs mt-1 form-helper-text">Proposed size: 350px * 180px. Max 2.5 MB.</p>
                </div>
                </div>
            </div>

            <!-- Step 2: Prospect Info -->
            <div id="step-2" class="form-step">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">

                <div class="md:col-span-1">
                    <label for="prospectFirstName" class="block text-sm font-medium mb-1 form-label-primary">First Name</label>
                    <input type="text" id="prospectFirstName" name="prospectFirstName" class="form-input-brand" placeholder="Jane">
                </div>

                <div class="md:col-span-1">
                    <label for="prospectLastName" class="block text-sm font-medium mb-1 form-label-primary">Last Name</label>
                    <input type="text" id="prospectLastName" name="prospectLastName" class="form-input-brand" placeholder="Doe">
                </div>

                <div class="md:col-span-2">
                    <label for="prospectEmail" class="block text-sm font-medium mb-1 form-label-primary">Email</label>
                    <input type="email" id="prospectEmail" name="prospectEmail" class="form-input-brand" placeholder="jane.doe@example.com">
                </div>
                </div>
            </div>

            <!-- Step 3: Authorized Representative -->
            <div id="step-3" class="form-step">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">

                <div class="md:col-span-1">
                    <label for="authFirstName" class="block text-sm font-medium mb-1 form-label-primary">First Name</label>
                    <input type="text" id="authFirstName" name="authFirstName" class="form-input-brand" placeholder="John">
                </div>

                <div class="md:col-span-1">
                    <label for="authLastName" class="block text-sm font-medium mb-1 form-label-primary">Last Name</label>
                    <input type="text" id="authLastName" name="authLastName" class="form-input-brand" placeholder="Smith">
                </div>

                <div class="md:col-span-1">
                    <label for="authEmail" class="block text-sm font-medium mb-1 form-label-primary">Email</label>
                    <input type="email" id="authEmail" name="authEmail" class="form-input-brand" placeholder="john.smith@example.com">
                </div>

                <div class="md:col-span-1">
                    <label for="authPhone" class="block text-sm font-medium mb-1 form-label-primary">Phone Number</label>
                    <input type="tel" id="authPhone" name="authPhone" class="form-input-brand" placeholder="+13145557777">
                </div>
                
                <div class="md:col-span-1">
                    <label for="authPosition" class="block text-sm font-medium mb-1 form-label-primary">Position</label>
                    <input type="text" id="authPosition" name="authPosition" class="form-input-brand" placeholder="e.g., Owner">
                </div>

                <div class="md:col-span-1">
                    <label for="authTitle" class="block text-sm font-medium mb-1 form-label-primary">Title</label>
                    <input type="text" id="authTitle" name="authTitle" class="form-input-brand" placeholder="e.g., CEO">
                </div>
                </div>
            </div>

            <!-- Step 4: Business Information -->
            <div id="step-4" class="form-step">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">

                <div class="md:col-span-1">
                    <label for="regionsOfOperation" class="block text-sm font-medium mb-1 form-label-primary">Business Regions of Operation</label>
                    <input type="text" id="regionsOfOperation" name="regionsOfOperation" class="form-input-brand" placeholder="e.g., North America">
                </div>

                <div class="md:col-span-1">
                    <label for="notRegistered" class="block text-sm font-medium mb-1 form-label-primary">My Business is Not Registered</label>
                    <select id="notRegistered" name="notRegistered" class="form-input-brand bg-white">
                        <option value="empty">Empty</option>
                        <option value="yes">Yes</option>
                        <option value="no">No</option>
                    </select>
                </div>

                <div class="md:col-span-1">
                    <label for="registrationNumber" class="block text-sm font-medium mb-1 form-label-primary">Business Registration Number</label>
                    <input type="text" id="registrationNumber" name="registrationNumber" class="form-input-brand" placeholder="e.g., 123456789">
                </div>

                <div class="md:col-span-1">
                    <label for="registrationIdType" class="block text-sm font-medium mb-1 form-label-primary">Business Registration ID Type</label>
                    <input type="text" id="registrationIdType" name="registrationIdType" class="form-input-brand" placeholder="e.g., EIN">
                </div>

                <div class="md:col-span-1">
                    <label for="businessIndustry" class="block text-sm font-medium mb-1 form-label-primary">Business Industry</label>
                    <select id="businessIndustry" name="businessIndustry" class="form-input-brand bg-white">
                        <option value="">Select Industry</option>
                        <option value="Technology">Technology</option>
                        <option value="Healthcare">Healthcare</option>
                        <option value="Finance">Finance</option>
                        <option value="Education">Education</option>
                        <option value="Retail">Retail</option>
                        <option value="Manufacturing">Manufacturing</option>
                        <option value="Real Estate">Real Estate</option>
                        <option value="Construction">Construction</option>
                        <option value="Transportation & Logistics">Transportation & Logistics</option>
                        <option value="Hospitality & Tourism">Hospitality & Tourism</option>
                        <option value="Food & Beverage">Food & Beverage</option>
                        <option value="Entertainment & Media">Entertainment & Media</option>
                        <option value="Energy & Utilities">Energy & Utilities</option>
                        <option value="Telecommunications">Telecommunications</option>
                        <option value="Professional Services">Professional Services</option>
                        <option value="Legal Services">Legal Services</option>
                        <option value="Insurance">Insurance</option>
                        <option value="Agriculture">Agriculture</option>
                        <option value="Mining">Mining</option>
                        <option value="Wholesale Trade">Wholesale Trade</option>
                        <option value="Non-profit">Non-profit</option>
                        <option value="Government">Government</option>
                        <option value="Other">Other</option>
                    </select>
                </div>

                <div class="md:col-span-1">
                    <label for="businessType" class="block text-sm font-medium mb-1 form-label-primary">Business Type</label>
                    <select id="businessType" name="businessType" class="form-input-brand bg-white">
                        <option value="">Select Business Type</option>
                        <option value="Sole Proprietorship">Sole Proprietorship</option>
                        <option value="Partnership">Partnership</option>
                        <option value="Limited Liability Company (LLC)">Limited Liability Company (LLC)</option>
                        <option value="C Corporation (C Corp)">C Corporation (C Corp)</option>
                        <option value="S Corporation (S Corp)">S Corporation (S Corp)</option>
                        <option value="Limited Partnership (LP)">Limited Partnership (LP)</option>
                        <option value="Limited Liability Partnership (LLP)">Limited Liability Partnership (LLP)</option>
                        <option value="Professional Corporation (PC)">Professional Corporation (PC)</option>
                        <option value="Professional LLC (PLLC)">Professional LLC (PLLC)</option>
                        <option value="Nonprofit Organization">Nonprofit Organization</option>
                        <option value="Cooperative">Cooperative</option>
                        <option value="Other">Other</option>
                    </select>
                </div>

                <!-- Section: Snapshot ID (Hidden) -->
                <div class="md:col-span-2 hidden">
                    <h2 class="section-header section-header-margin">
                        <div class="section-icon">
                            <i class="fas fa-camera"></i>
                        </div>
                        Snapshot
                    </h2>
                </div>
                
                <div class="md:col-span-2 hidden">
                    <label for="snapshotId" class="block text-sm font-medium mb-1 form-label-primary">Snapshot ID</label>
                    <input type="hidden" id="snapshotId" name="snapshotId" value="EwIHwKcK1vKjvIz8PmF7">
                </div>
                </div>
            </div>

            <!-- Navigation Buttons -->
            <div class="nav-buttons">
                <button type="button" id="prevBtn" class="btn-nav prev" disabled>
                    <i class="fas fa-arrow-left mr-2"></i>Previous
                </button>
                <button type="button" id="nextBtn" class="btn-nav next">
                    Next<i class="fas fa-arrow-right ml-2"></i>
                </button>
                <button type="submit" id="submitBtn" class="btn-nav submit submit-button-hidden">
                    <span id="submitBtnText">Submit Form</span>
                    <i id="submitBtnSpinner" class="fas fa-spinner fa-spin hidden ml-2"></i>
                </button>
            </div>
        </form>

    </div>

    <!-- Custom Modal for Success Message (Replaces alert()) -->
    <div id="successModal" class="modal-backdrop hidden opacity-0" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="modal-title">
        <div class="modal-content opacity-0 translate-y-4">
            <div class="text-center">
                <!-- Success Checkmark from Branding Guide -->
                <div class="success-checkmark mx-auto mb-4 modal-success-icon">
                    <div class="check-icon modal-success-check-icon">
                        <span class="icon-line line-tip modal-success-line-tip"></span>
                        <span class="icon-line line-long modal-success-line-long"></span>
                    </div>
                </div>
                <h3 id="modal-title" class="text-2xl font-bold mb-2 modal-title-text">Success!</h3>
                <p class="mb-4 modal-message-text">Your form has been submitted successfully.</p>
                <button id="closeModalBtn" class="w-full btn-submit-brand modal-button-primary">
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- Custom Modal for Error Message -->
    <div id="errorModal" class="modal-backdrop hidden opacity-0" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="error-modal-title">
        <div class="modal-content opacity-0 translate-y-4">
            <div class="text-center">
                <!-- Error Icon -->
                <div class="mx-auto mb-4 modal-error-icon">
                    <div class="check-icon modal-error-check-icon">
                        <span class="modal-error-line modal-error-line-rotate-45"></span>
                        <span class="modal-error-line modal-error-line-rotate-neg-45"></span>
                    </div>
                </div>
                <h3 id="error-modal-title" class="text-2xl font-bold mb-2 modal-title-text">Submission Failed</h3>
                <p class="mb-4 modal-message-text" id="errorModalMessage">An unexpected error occurred. Please try again.</p>
                <button id="closeErrorModalBtn" class="w-full btn-submit-brand modal-button-secondary">
                    Close
                </button>
            </div>
        </div>
    </div>


    <script>
        'use strict';
        
        // Step Navigation
        const TOTAL_STEPS = 4;
        let currentStep = 1;
        
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const submitBtn = document.getElementById('submitBtn');
        const progressBar = document.getElementById('progressBar');
        const progressText = document.getElementById('progressText');
        
        function updateProgress() {
            const progress = (currentStep / TOTAL_STEPS) * 100;
            
            // Update progress bar
            if (progressBar) {
                if (typeof anime !== 'undefined') {
                    anime({
                        targets: progressBar,
                        width: `${progress}%`,
                        duration: 1000,
                        easing: 'easeInOutQuad'
                    });
                } else {
                    progressBar.style.width = `${progress}%`;
                }
            }
            
            // Update step text
            if (progressText) {
                progressText.textContent = `Step ${currentStep}`;
            }
            
            // Update journey step cards
            for (let i = 1; i <= TOTAL_STEPS; i++) {
                const journeyStep = document.getElementById(`journey-step-${i}`);
                if (journeyStep) {
                    journeyStep.className = 'journey-step';
                    
                    if (i < currentStep) {
                        journeyStep.classList.add('completed');
                        // Animate checkmark
                        if (typeof anime !== 'undefined' && i === currentStep - 1) {
                            const checkmark = journeyStep.querySelector('.journey-checkmark');
                            if (checkmark) {
                                anime({
                                    targets: checkmark,
                                    scale: [0, 1.2, 1],
                                    rotate: [0, 360],
                                    duration: 600,
                                    easing: 'easeOutElastic(1, .6)'
                                });
                                checkmark.classList.remove('hidden');
                            }
                        }
                    } else if (i === currentStep) {
                        journeyStep.classList.add('active');
                        // Pulse animation
                        if (typeof anime !== 'undefined') {
                            anime({
                                targets: journeyStep,
                                scale: [1, 1.05, 1],
                                duration: 600,
                                easing: 'easeInOutQuad'
                            });
                        }
                    } else {
                        journeyStep.classList.add('pending');
                    }
                }
            }
        }
        
        function showStep(step) {
            // Hide all steps
            for (let i = 1; i <= TOTAL_STEPS; i++) {
                const stepEl = document.getElementById(`step-${i}`);
                if (stepEl) {
                    stepEl.classList.remove('active');
                    stepEl.classList.add('form-step');
                }
            }
            
            // Show current step
            const currentStepEl = document.getElementById(`step-${step}`);
            if (currentStepEl) {
                currentStepEl.classList.add('active');
                currentStepEl.classList.remove('form-step');
                
                // Animate step entrance
                if (typeof anime !== 'undefined') {
                    anime({
                        targets: currentStepEl,
                        opacity: [0, 1],
                        translateX: [50, 0],
                        duration: 800,
                        easing: 'easeOutExpo'
                    });
                }
            }
            
            // Update navigation buttons
            if (prevBtn) {
                prevBtn.disabled = step === 1;
            }
            
            if (nextBtn && submitBtn) {
                if (step === TOTAL_STEPS) {
                    nextBtn.style.display = 'none';
                    submitBtn.style.display = 'inline-flex';
                    submitBtn.style.alignItems = 'center';
                } else {
                    nextBtn.style.display = 'inline-flex';
                    submitBtn.style.display = 'none';
                }
            }
            
            // Scroll to top - Mobile optimized
            const scrollTarget = window.self !== window.top ? 
                document.getElementById('connectionForm')?.parentElement : 
                window;
            
            if (scrollTarget === window) {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            } else if (scrollTarget) {
                scrollTarget.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
            
            updateProgress();
        }
        
        function validateStep(step) {
            const stepEl = document.getElementById(`step-${step}`);
            if (!stepEl) return true;
            
            const requiredFields = stepEl.querySelectorAll('[required]');
            let isValid = true;
            
            requiredFields.forEach(field => {
                // Skip hidden fields
                if (field.offsetParent === null) return;
                
                if (!field.value.trim()) {
                    field.classList.add('error');
                    isValid = false;
                } else {
                    field.classList.remove('error');
                }
            });
            
            return isValid;
        }
        
        // Navigation event listeners
        if (nextBtn) {
            nextBtn.addEventListener('click', function() {
                if (validateStep(currentStep)) {
                    if (currentStep < TOTAL_STEPS) {
                        currentStep++;
                        showStep(currentStep);
                    }
                } else {
                    // Mobile-friendly error display
                    const stepEl = document.getElementById(`step-${currentStep}`);
                    if (stepEl) {
                        const firstError = stepEl.querySelector('.form-input-brand.error');
                        if (firstError) {
                            firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                            firstError.focus();
                        }
                    }
                    // Use modal instead of alert for better UX in iframe
                    if (typeof window.showErrorModal === 'function') {
                        window.showErrorModal('Please fill in all required fields before continuing.');
                    } else {
                        alert('Please fill in all required fields before continuing.');
                    }
                }
            });
        }
        
        if (prevBtn) {
            prevBtn.addEventListener('click', function() {
                if (currentStep > 1) {
                    currentStep--;
                    showStep(currentStep);
                }
            });
        }
        
        // Initialize on page load - Optimized for iframe embedding
        function initializeForm() {
            try {
                showStep(1);
                updateProgress();
                
                // Handle iframe context for GoHighLevel
                if (window.self !== window.top) {
                    // We're in an iframe
                    document.body.style.minHeight = 'auto';
                    
                    // Adjust modal z-index for iframe
                    const modals = document.querySelectorAll('.modal-backdrop');
                    modals.forEach(modal => {
                        modal.style.zIndex = '999999';
                    });
                }
            } catch (error) {
                console.error('Error initializing form:', error);
            }
        }
        
        // Initialize when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                setTimeout(initializeForm, 100); // Small delay to ensure all scripts loaded
            });
        } else {
            setTimeout(initializeForm, 100);
        }
        
        // Form submission handler - Wait for DOM to be ready
        function setupFormSubmission() {
            const form = document.getElementById('connectionForm');
            if (!form) {
                console.error('Form not found');
                return;
            }
            
            form.addEventListener('submit', async function(event) {
            event.preventDefault();
            console.log('Form submission intercepted.');

            const webhookUrl = 'https://hook.us2.make.com/j49gw3ktjfi4i7uq1xtllul2r9co02if';
            
            const submitBtn = document.getElementById('submitBtn');
            const submitBtnText = document.getElementById('submitBtnText');
            const submitBtnSpinner = document.getElementById('submitBtnSpinner');

            // Show loading state
            submitBtn.disabled = true;
            submitBtnText.classList.add('hidden');
            submitBtnSpinner.classList.remove('hidden');

            try {
                const formData = new FormData(event.target);
                const data = Object.fromEntries(formData.entries());
                console.log('Form Data:', data);

                const response = await fetch(webhookUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    // Success
                    console.log('Webhook submission successful');
                    if (typeof window.showSuccessModal === 'function') {
                        window.showSuccessModal();
                    }
                    // Reset form and go back to step 1
                    event.target.reset();
                    currentStep = 1;
                    showStep(1);
                } else {
                    // Server error
                    console.error('Webhook submission failed:', response.status, response.statusText);
                    const responseText = await response.text();
                    if (typeof window.showErrorModal === 'function') {
                        window.showErrorModal(`Server responded with status ${response.status}: ${responseText}`);
                    } else {
                        alert(`Server error: ${response.status}`);
                    }
                }
            } catch (error) {
                // Network error
                console.error('Error submitting to webhook:', error);
                if (typeof window.showErrorModal === 'function') {
                    window.showErrorModal('A network error occurred. Please check your connection and try again.');
                } else {
                    alert('A network error occurred. Please check your connection and try again.');
                }
            } finally {
                // Reset button state
                submitBtn.disabled = false;
                submitBtnText.classList.remove('hidden');
                submitBtnSpinner.classList.add('hidden');
            }
        });
        }
        
        // Setup form submission when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', setupFormSubmission);
        } else {
            setupFormSubmission();
        }

        // Modal JS - Initialize after DOM is ready
        let successModal, closeModalBtn, successModalContent;
        let errorModal, closeErrorModalBtn, errorModalContent, errorModalMessage;

        function initializeModals() {
            try {
                successModal = document.getElementById('successModal');
                closeModalBtn = document.getElementById('closeModalBtn');
                if (successModal && closeModalBtn) {
                    successModalContent = successModal.querySelector('.modal-content');
                    
                    closeModalBtn.addEventListener('click', hideSuccessModal);
                    successModal.addEventListener('click', function(event) {
                        if (event.target === successModal) {
                            hideSuccessModal();
                        }
                    });
                }

                // Error Modal JS
                errorModal = document.getElementById('errorModal');
                closeErrorModalBtn = document.getElementById('closeErrorModalBtn');
                if (errorModal && closeErrorModalBtn) {
                    errorModalContent = errorModal.querySelector('.modal-content');
                    errorModalMessage = document.getElementById('errorModalMessage');
                    
                    closeErrorModalBtn.addEventListener('click', hideErrorModal);
                    errorModal.addEventListener('click', function(event) {
                        if (event.target === errorModal) {
                            hideErrorModal();
                        }
                    });
                }
            } catch (error) {
                console.error('Error initializing modals:', error);
            }
        }

        // Make showSuccessModal globally accessible
        window.showSuccessModal = function() {
            if (!successModal || !successModalContent) return;
            successModal.classList.remove('hidden');
            setTimeout(() => {
                successModal.classList.remove('opacity-0');
                successModalContent.classList.remove('opacity-0', 'translate-y-4');
            }, 10);
        };

        function hideSuccessModal() {
            if (!successModal || !successModalContent) return;
            successModal.classList.add('opacity-0');
            successModalContent.classList.add('opacity-0', 'translate-y-4');
            setTimeout(() => {
                successModal.classList.add('hidden');
            }, 300);
        }

        // Make showErrorModal globally accessible
        window.showErrorModal = function(message = 'An unexpected error occurred. Please try again.') {
            if (!errorModal || !errorModalContent || !errorModalMessage) {
                // Fallback to alert if modals aren't initialized
                alert(message);
                return;
            }
            errorModalMessage.textContent = message;
            errorModal.classList.remove('hidden');
            setTimeout(() => {
                errorModal.classList.remove('opacity-0');
                errorModalContent.classList.remove('opacity-0', 'translate-y-4');
            }, 10);
        };

        function hideErrorModal() {
            if (!errorModal || !errorModalContent) return;
            errorModal.classList.add('opacity-0');
            errorModalContent.classList.add('opacity-0', 'translate-y-4');
            setTimeout(() => {
                errorModal.classList.add('hidden');
            }, 300);
        }

        // Initialize modals when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeModals);
        } else {
            initializeModals();
        }


        // Initialize animations from branding guide - Mobile optimized
        function initializeAnimations() {
            // Check if animations should run (reduce on mobile for performance)
            const isMobile = window.innerWidth <= 768;
            const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
            
            if (prefersReducedMotion || (isMobile && typeof anime === 'undefined')) {
                // Skip animations for better mobile performance
                document.querySelectorAll('.animate-in').forEach(el => {
                    el.style.opacity = '1';
                });
                return;
            }
            
            if (typeof anime === 'undefined') {
                console.warn('Anime.js not loaded, skipping animations.');
                return;
            }

            // Reduced animation duration on mobile
            const baseDuration = isMobile ? 600 : 1200;
            const baseDelay = isMobile ? 100 : 300;

            // Animate header
            anime({
                targets: 'header.animate-in',
                opacity: [0, 1],
                translateY: [-30, 0],
                duration: baseDuration,
                easing: 'easeOutExpo'
            });

            // Animate form card
            anime({
                targets: '#connectionForm',
                opacity: [0, 1],
                translateY: [30, 0],
                duration: baseDuration * 0.8,
                delay: baseDelay,
                easing: 'easeOutExpo'
            });
            
            // Animate journey tracker
            anime({
                targets: '#journey-tracker',
                opacity: [0, 1],
                translateY: [30, 0],
                duration: baseDuration * 0.8,
                delay: baseDelay * 1.5,
                easing: 'easeOutExpo'
            });
            
            // Animate journey step cards with stagger (reduced on mobile)
            anime({
                targets: '.journey-step',
                opacity: [0, 1],
                translateY: [30, 0],
                scale: isMobile ? [1, 1] : [0.9, 1], // Skip scale on mobile
                delay: anime.stagger(isMobile ? 40 : 80, {start: baseDelay * 2}),
                duration: baseDuration * 0.7,
                easing: 'easeOutElastic(1, .6)'
            });
        }
        
        // Initialize animations after DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                setTimeout(initializeAnimations, 100); // Small delay for iframe context
            });
        } else {
            setTimeout(initializeAnimations, 100);
        }
    </script>
</body>
</html>